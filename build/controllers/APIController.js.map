{"version":3,"file":"APIController.js","sourceRoot":"","sources":["../../src/controllers/APIController.ts"],"names":[],"mappings":"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","sourcesContent":["import Excel  from 'exceljs';\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport { get, post, bodyValidator, controller, del, use } from './decorators/index';\r\nimport { upload, clearUploads } from '../middlewares';\r\nimport { Products, FacilitiesMap } from '../interfaces';\r\n\r\nconst testm = (req, res, next)=>{\r\n\tconsole.log('testm');\r\n\tnext();\r\n}\r\nconst testt = (req, res, next)=>{\r\n\tconsole.log('testt', req.body);\r\n\tnext();\r\n}\r\n@controller('/api')\r\nclass APIController {\r\n\t@post('/file')\r\n\t@use(upload.single('excelFileURL'))\r\n\tasync sendFile(req: Request, res: Response){\r\n\t\tconst { file } = req;\r\n\t    let fileURL = (file)? file.path: '';\r\n\t    console.log(fileURL);\r\n\t    try{\r\n\t\t\tconst output = new Excel.Workbook();\r\n\t\t\toutput.creator = 'Me';\r\n\t\t\toutput.lastModifiedBy = 'Me';\r\n\t\t\toutput.modified = new Date();\r\n\t\t\toutput.created = new Date();\r\n\t\t\t//const workbook = await new Excel.Workbook().xlsx.readFile('./excel.xlsx')//.then((workbook)=>{\r\n\t\t\tconst workbook = await new Excel.Workbook().xlsx.readFile(fileURL);\r\n\t\t\tconst products: Products[] = [];\r\n\t\t\tconst facilities: FacilitiesMap[] = [];\r\n\t\t\tlet lga = '', facility = '', k = 1;\r\n\t\t\tconst lgas = [\r\n\t\t\t                  'birnin gwari', 'chikun', 'giwa', 'igabi', 'ikara', 'jaba',\r\n\t\t\t                  'jema a', 'kachia', 'kaduna north', 'kaduna south', 'kagarko',\r\n\t\t\t                  'kajuru', 'kaura', 'kauru', 'kubau', 'kudan', 'lere', 'makarfi',\r\n\t\t\t                  'sabon gari', 'sanga', 'soba', 'zangon kataf', 'zaria'\r\n\t\t                 ];\r\n\t\t\tlgas.map(lga=>{ output.addWorksheet(lga); });\r\n\t\t\tconst addedLgas: string[] = [];\r\n\t\t\tconst lgasMap = new Map<string, FacilitiesMap[]>();\r\n\t\t\tconst facilityMap: FacilitiesMap = new Map<string, Products[]>();\r\n\t\t\tlet startDatanext = false;\r\n\t\t\tconst worksheet = workbook.getWorksheet('LMD ACTUAL AND FOR POD');\r\n\t\t\tif(!worksheet){\r\n\t\t\t\tconst data = { success: false, msg: `Please check the sheet name in the file you sent, it should be 'LMD ACTUAL AND FOR POD' no space before or after`}\r\n\t\t\t\treturn res.statusJson(400, { data: data });\r\n\t\t\t}\r\n\t\t\tworksheet.eachRow((row)=>{\r\n\t\t\t    let i = 0,j = 0;\r\n\t\t\t    let localProducts: Products[] = [];\r\n\t\t\t    row.eachCell((cell, colnumber)=>{\r\n\t\t\t    \tlet table: Excel.Table;\r\n\t\t\t    \tif(row.getCell('A').toString().toLowerCase() === ' facility profile' && colnumber > 5 && row.getCell('F').toString().toLowerCase() === 'female condom'){\r\n\t\t\t        \tproducts.push({product: cell.value, unit: '', qty: 0});\r\n\t\t\t    \t}else if(row.getCell('A').toString().toLowerCase() === ' facility profile' && colnumber > 5 && products.length > 0){\r\n\t\t\t\t        products[i].unit = cell.value;\r\n\t\t\t\t        i++;\r\n\t\t\t\t    }\r\n\t\t\t    \tif(row.getCell('S').toString().toLowerCase() === 'quantity supplied'){\r\n\t\t\t        \tstartDatanext = true;\r\n\t\t\t    \t}\r\n\t\t\t    \tif(startDatanext){\r\n\t\t\t\t        const notFive = ['total', 'facility profile', 'sitename'];\r\n\t\t\t\t        if(row.getCell('D').toString().toLowerCase() !== 'total'){\r\n\t\t\t\t        \tlga = row.getCell('E').toString().toLowerCase();\r\n\t\t\t\t        }\r\n\t\t\t\t        localProducts = products.map(prod=>{\r\n\t\t\t\t        \treturn {...prod};\r\n\t\t\t\t        });\r\n\t\t\t\t        if(colnumber === 4 && lgas.includes(lga) && !addedLgas.includes(lga)){\r\n\t\t\t\t        \tif(!notFive.includes(cell.value.toString().toLowerCase())){\r\n\t\t\t\t\t            facility = cell.value.toString().slice(0, 31);\r\n\t\t\t\t\t            const sheet = output.getWorksheet(lga);\r\n\t\t\t\t\t            table = sheet && sheet.addTable({\r\n\t\t\t\t\t              name: facility,\r\n\t\t\t\t\t              displayName: facility,\r\n\t\t\t\t\t              ref: `A${k+6}`,\r\n\t\t\t\t\t              columns: [\r\n\t\t\t\t\t                {name: 'S/N'},\r\n\t\t\t\t\t                {name: 'PRODUCTS'},\r\n\t\t\t\t\t                {name: 'UNITS'},\r\n\t\t\t\t\t                {name: 'QTY ISSUED'},\r\n\t\t\t\t\t                {name: 'QTY RECEIVED'},\r\n\t\t\t\t\t                {name: 'REMARKS'},\r\n\t\t\t\t\t              ],\r\n\t\t\t\t\t              rows: [],\r\n\t\t\t\t\t              style: {\r\n\t\t\t\t\t                theme: 'TableStyleLight15'\r\n\t\t\t\t\t              }\r\n\t\t\t\t\t            });\r\n\t\t\t\t\t            k = k + products.length + 20;\r\n\t\t\t\t        \t}\r\n\t\t\t\t        \tif(cell.value.toString().toLowerCase() === 'total'){\r\n\t\t\t\t\t            const localMap  = new Map(facilityMap);\r\n\t\t\t\t\t            facilityMap.clear();\r\n\t\t\t\t\t            facilities.push(localMap);\r\n\t\t\t\t\t            const localFacilities = facilities.map(facility=> facility);\r\n\t\t\t\t\t            lgasMap.set(lga, [...localFacilities]);\r\n\r\n\t\t\t\t\t            facilities.splice(0);\r\n\t\t\t\t\t            addedLgas.push(lga);\r\n\t\t\t\t\t            startDatanext = false;\r\n\t\t\t\t\t            k = 1; j = 0; i = 0;\r\n\t\t\t\t\t            products.splice(0);\r\n\t\t\t\t\t        }\r\n\t\t\t\t        }\r\n\t\t\t\t        if(colnumber > 5 && facility){\r\n\t\t\t\t        \tif(facilityMap.get(facility)){\r\n\t\t\t\t            \tlocalProducts = facilityMap.get(facility);\r\n\t\t\t\t        \t}\r\n\t\t\t\t        \t//@ts-ignore\r\n\t\t\t\t\t\t\tlocalProducts[j].qty = (cell.value.result)? Number.parseInt(cell.value.result) : Number.parseInt(cell.value);\r\n\t\t\t\t\t\t\tj++;\r\n\t\t\t\t\t\t\tfacilityMap.set(facility, [...localProducts]);\r\n\t\t\t\t        }\r\n\t\t\t    \t}\r\n\t\t\t    });\r\n\t\t\t});\r\n\r\n\t\t\toutput.eachSheet(sheet=>{\r\n\t\t\t    const facilities = lgasMap.get(sheet.name);\r\n\t\t\t    facilities && facilities.forEach((value)=>{\r\n\t\t\t\t\tlet facilityNo = 1;\r\n\t\t\t\t\t\tvalue.forEach((products, key)=>{\r\n\t\t\t\t\t\tconst table = sheet.getTable(key);\r\n\t\t\t\t\t\tif(table){\r\n\t\t\t\t\t\t  const ref = table.ref;\r\n\t\t\t\t\t\t  const columnNo = ref.substring(0, 1);\r\n\t\t\t\t\t\t  const rowNo = ref.substring(1);\r\n\t\t\t\t\t\t  sheet.getColumn('B').width = 21;\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)-6}`).value = 'PROOF OF DELIVERY FOR FAMILY PLANNING COMMODITIES';\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)-6}`).font = { bold: true };\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)-6}`).alignment = { vertical: 'middle', horizontal: 'center' };\r\n\t\t\t\t\t\t  sheet.mergeCells(`${columnNo}${Number.parseInt(rowNo)-6}:${'F'}${Number.parseInt(rowNo)-6}`);\r\n\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)-4}`).value = 'Date:';\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)-4}`).font = { bold: true };\r\n\t\t\t\t\t\t  sheet.getCell(`${'B'}${Number.parseInt(rowNo)-4}`).value = new Date();\r\n\t\t\t\t\t\t  sheet.getCell(`${'B'}${Number.parseInt(rowNo)-4}`).font = { bold: true };\r\n\r\n\t\t\t\t\t\t  sheet.getCell(`${'C'}${Number.parseInt(rowNo)-4}`).value = 'POD No.:';\r\n\t\t\t\t\t\t  sheet.getCell(`${'C'}${Number.parseInt(rowNo)-4}`).font = { bold: true };\r\n\t\t\t\t\t\t  sheet.getCell(`${'D'}${Number.parseInt(rowNo)-4}`).value = facilityNo++;\r\n\t\t\t\t\t\t  sheet.getCell(`${'D'}${Number.parseInt(rowNo)-4}`).font = { bold: true };\r\n\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)-2}`).value = 'LGA:';\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)-2}`).font = { bold: true };\r\n\t\t\t\t\t\t  sheet.getCell(`${'B'}${Number.parseInt(rowNo)-2}`).value = sheet.name;\r\n\t\t\t\t\t\t  sheet.getCell(`${'B'}${Number.parseInt(rowNo)-2}`).font = { bold: true };\r\n\r\n\t\t\t\t\t\t  sheet.getCell(`${'C'}${Number.parseInt(rowNo)-2}`).value = 'Facility Name:';\r\n\t\t\t\t\t\t  sheet.getCell(`${'C'}${Number.parseInt(rowNo)-2}`).font = { bold: true };\r\n\t\t\t\t\t\t  sheet.getCell(`${'E'}${Number.parseInt(rowNo)-2}`).value = key;\r\n\t\t\t\t\t\t  sheet.getCell(`${'E'}${Number.parseInt(rowNo)-2}`).font = { bold: true };\r\n\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)+products.length+3}`).value = 'Supplied By:..............................';\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)+products.length+3}`).font = { bold: true };\r\n\r\n\t\t\t\t\t\t  sheet.getCell(`${'D'}${Number.parseInt(rowNo)+products.length+3}`).value = 'Date:';\r\n\t\t\t\t\t\t  sheet.getCell(`${'D'}${Number.parseInt(rowNo)+products.length+3}`).font = { bold: true };\r\n\t\t\t\t\t\t  sheet.getCell(`${'E'}${Number.parseInt(rowNo)+products.length+3}`).value = '..............................';\r\n\t\t\t\t\t\t  sheet.getCell(`${'E'}${Number.parseInt(rowNo)+products.length+3}`).font = { bold: true };\r\n\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)+products.length+5}`).value = 'Recieved By:..............................';\r\n\t\t\t\t\t\t  sheet.getCell(`${columnNo}${Number.parseInt(rowNo)+products.length+5}`).font = { bold: true };\r\n\r\n\t\t\t\t\t\t  sheet.getCell(`${'D'}${Number.parseInt(rowNo)+products.length+5}`).value = 'Date:';\r\n\t\t\t\t\t\t  sheet.getCell(`${'D'}${Number.parseInt(rowNo)+products.length+5}`).font = { bold: true };\r\n\t\t\t\t\t\t  sheet.getCell(`${'E'}${Number.parseInt(rowNo)+products.length+5}`).value = '..............................';\r\n\t\t\t\t\t\t  sheet.getCell(`${'E'}${Number.parseInt(rowNo)+products.length+5}`).font = { bold: true };\r\n\t\t\t\t\t\t  for(let i = 0; i < products.length; i++){\r\n\t\t\t\t\t\t    table.addRow([i+1, products[i].product, products[i].unit, products[i].qty]);\r\n\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t  table.commit();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t    });\r\n\t\t\t});\r\n\r\n\t\t\tconst data = { success: true, url: '' };\r\n    \t\toutput.xlsx.writeFile('./uploads/output.xlsx').then(function() {\r\n\t\t\t    console.log(\"xls file is written to output.\");\r\n\t\t\t    data.success = true;\r\n\t\t\t    data.url = './uploads/output.xlsx';\r\n\t\t\t}).catch(err=>{\r\n\t\t\t    data.success = false;\r\n\t\t\t    console.log(err)\r\n\t\t\t});\r\n\t    \tsetTimeout(()=>{\r\n\t\t\t\treturn res.statusJson(200, { data: data });\r\n\t    \t}, 10000);\r\n\t    } catch(err){\r\n\t\t    console.log(err);\r\n\t\t\treturn res.statusJson(500, { err });\r\n\t\t}\t\t\r\n\t}\r\n}"]}